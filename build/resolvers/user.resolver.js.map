{"version":3,"sources":["../../src/resolvers/user.resolver.js"],"names":["module","exports","Query","users","parent","args","context","Models","User","find","user","findById","id","login","Email","Error","bcrypt","compareSync","Password","valid","token","jwt","sign","_id","IsAdmin","process","env","JWT_SECRET","expiresIn","Mutation","deleteUser","findByIdAndDelete","userUpdate","findByIdAndUpdate","Firstname","Adress","Phone","Lastname","console","log","signup","hash","save"],"mappings":"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","sourcesContent":["import bcrypt from \"bcrypt\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport { Model } from \"mongoose\";\r\nimport * as Models from \"../models\";\r\nimport utils from \"../utils/utils\";\r\nmodule.exports = {\r\n  Query: {\r\n    users: (parent, args, context) => {\r\n      // if (!context.req.isAuth) {\r\n      //   throw new Error('Unauthenticated!');\r\n      // }\r\n      return Models.User.find();\r\n    },\r\n    user: (parent, args, context) => {\r\n      // if (!context.req.isAuth) {\r\n      //   throw new Error(\"Unauthenticated!\");\r\n      // }\r\n      return Models.User.findById(args.id);\r\n    },\r\n    login: async (parent, args, context) => {\r\n      // utils.IsAdmin(context.req);\r\n    \r\n      const User = await Models.User.find({ Email: args.Email });\r\n\r\n      if (!User[0]) {\r\n    \r\n        throw new Error(\"Email is Incorrect\");\r\n      }\r\n      const valid = await bcrypt.compareSync(args.Password, User[0].Password);\r\n      if (!valid) {\r\n        throw new Error(\"Incorrect password\");\r\n      }\r\n\r\n      // return json web token\r\n      const token = jwt.sign(\r\n        { id: User[0]._id, Email: User[0].Email, IsAdmin: User[0].IsAdmin },\r\n        process.env.JWT_SECRET,\r\n        { expiresIn: \"1d\" }\r\n      );\r\n      return token;\r\n    },\r\n  },\r\n  Mutation: {\r\n    deleteUser: (parent, args) => {\r\n      return Models.User.findByIdAndDelete(args.id);\r\n    },\r\n    /*\r\n    +-------------------------------------------------------------+\r\n    | UPDATE\r\n    +-------------------------------------------------------------+\r\n    */\r\n    userUpdate: async (parent, args, context) => {\r\n      // if (!context.req.isAuth) {\r\n      //   throw new Error('Unauthenticated!');\r\n      // }\r\n      try {\r\n        await Models.User.findByIdAndUpdate(\r\n          { _id: args.id },\r\n          { \r\n          Firstname: args.Firstname,\r\n          Email:args.Email,\r\n          Adress:args.Adress,\r\n          Phone:args.Phone,\r\n          Password:args.Password,\r\n          Lastname:args.Lastname,\r\n          IsAdmin:args.IsAdmin\r\n         }\r\n        );\r\n        return Models.User.findById(args.id);\r\n      } catch (error) {\r\n        console.log(error);\r\n      }\r\n    },\r\n    /*\r\n    +-------------------------------------------------------------+\r\n    | SIGN UP\r\n    +-------------------------------------------------------------+\r\n    */\r\n    signup: async (parent, args, context) => {\r\n      const User = new Models.User({\r\n        Firstname: args.Firstname,\r\n        Lastname: args.Lastname,\r\n        Phone: args.Phone,\r\n        Adress: args.Adress,\r\n        Email: args.Email,\r\n        Password: await bcrypt.hash(args.Password, 10),\r\n        IsAdmin: args.IsAdmin,\r\n      });\r\n      await User.save();\r\n      console.log(\"Enregistrer\");\r\n      // return json web token\r\n      return jwt.sign({ Email: User.Email }, process.env.JWT_SECRET, {\r\n        expiresIn: \"1y\",\r\n      });\r\n    },\r\n  },\r\n};\r\n"],"file":"user.resolver.js"}